import Playground from "../../../../../../src/components/playground";

## 请求登录

通过Trezor进行质询响应身份验证。防止重放攻击
您应该为每个服务器端使用服务器端生成的随机化的“ challengeHidden”
试图。您还可以提供视觉挑战，该挑战将显示在
设备。

服务后端需要检查签名是否与生成的签名匹配
“ challengeHidden”，提供了“ challengeVisual”并存储了“ publicKey”字段。
如果是这种情况，则后端可以创建一个帐户(如果`publicKey`
首次看到身份)或登录用户(如果“ publicKey”
身份已经是已知用户)。

要了解完整的机制，请查阅“挑战-响应”一章
的
[SLIP-0013：使用确定性层次结构进行身份验证](https://github.com/satoshilabs/slips/blob/master/slip-0013.md)。


ES6
```javascript
const result = await OneKeyConnect.requestLogin(params);
```

CommonJS
```javascript
OneKeyConnect.requestLogin(params).then(function(result) {

});
```

### 参数
[****可选的通用参数****](./commonParams)
<br/>
公用参数`useEmptyPassphrase`-始终设置为`true`，此方法将忽略它
####使用服务器端异步质询登录
-`callback` — *必选*函数，将从API调用以从服务器获取`challengeHidden`和`challengeVisual`

#### 无需异步挑战即可登录
-`challengeHidden`-*必须*`string'十六进制值
-`challengeVisual`-在Trezor上显示的* string *字符串是必填项

### Example
###### Login using server-side async challenge
```javascript
OneKeyConnect.requestLogin({
    callback: function() {
        // here should be a request to server to fetch "challengeHidden" and "challengeVisual"
        return {
            challengeHidden: '0123456789abcdef',
            challengeVisual: 'Login to',
        }
    }
})
```

###### Login without async challenge
```javascript
OneKeyConnect.requestLogin({
    challengeHidden: '0123456789abcdef',
    challengeVisual: 'Login to',
})
```

### Result
```javascript
{
    success: true,
    payload: {
        address: string,
        publicKey: string,
        signature: string,
    }
}
```
Error
```javascript
{
    success: false,
    payload: {
        error: string // error message
    }
}
```

### Server side examples

Here is the reference implementation of the server-side signature verification
written in various languages:

- [**C#**](server/server.cs)
- [**Javascript**](server/server.js)
- [**PHP**](server/server.php)
- [**Python**](server/server.py)
- [**Ruby**](server/server.rb)



### Migration from older version

version 4 and below
```javascript
// site icon, optional. at least 48x48px
var hosticon = 'https://example.com/icon.png';
// server-side generated and randomized challenges
var challenge_hidden = '';
var challenge_visual = '';
OneKeyConnect.requestLogin(
    hosticon,                // hosticon is moved to common parameters
    challenge_hidden,
    challenge_visual
    function(result) {
        result.signatures    // not changed
        result.public_key    // renamed to "publicKey"
        result.version       // removed, it's not possible to use this method witch outdated firmware
        // added "address" field
    }
);
```
version 5
```javascript
// params are key-value pairs inside Object
OneKeyConnect.requestLogin({
    challengeHidden: '',
    challengeVisual: '',
}).then(function(result) {
    ...
})
```


### try it out
<Playground
    initValue={
`OneKeyConnect.requestLogin({
    challengeHidden: '0123456789abcdef',
    challengeVisual: 'Login to',
})`}
/>

